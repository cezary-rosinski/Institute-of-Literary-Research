---
title: "R Notebook"
output: html_notebook
---

```{r}
library(RSelenium)
library(RCurl)
library(XML)
library(rvest)
library(tidyverse)
library(stringr)
library(svMisc)
library(splitstackshape)
library(stringdist)
library(RJDBC)
library(purrr)
library(sqldf)
library(binman)

#empty table
table_data <- data.frame(stringsAsFactors=FALSE)
#browser
#list_versions("chromedriver")
rD <- rsDriver(port=4444L,browser="chrome", chromever="78.0.3904.11")
remDr <- rD$client


pages <- data.frame(url=c("http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090729_152643_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090814_145248_blogovy-roman_ven.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090830_133601_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090913_221745_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090927_204250_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091011_193104_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091025_205705_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091108_200500_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091122_195330_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091206_203908_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091220_175017_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090814_153618_blogovy-roman_ven.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090828_181703_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091002_155247_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091015_125624_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091030_103027_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091204_095600_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091208_163015_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091216_173919_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090730_132805_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090814_150720_blogovy-roman_ven.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090830_135629_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090913_215105_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A090927_211140_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091011_191630_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091025_211101_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091108_194337_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091122_194606_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091206_202107_blogovy-roman_jdv.html","http://data.idnes.cz/BlogovyRoman/diskuse.aspx@iddiskuse=A091220_224008_blogovy-roman_jdv.html"),number=1:30)


x <- 1:50
y <- 1:30

for (j in y) {
  progress(match(j,y), max.value = length(y))
  url <- pages$url[j]
  remDr$navigate(url)

while (length(remDr$findElement(using = 'css selector', "div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list div.contribution:nth-child(1) table:nth-child(1) tbody:nth-child(1) tr:nth-child(1) td.cell > h4.name"))>0) {
for (i in x) {
  progress(match(i,x), max.value = length(x))

  possibleError2 <- tryCatch({

  tryCatch({
name <- remDr$findElement(using = 'css selector', paste("div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list div.contribution:nth-child(",i,") table:nth-child(1) tbody:nth-child(1) tr:nth-child(1) td.cell > h4.name",sep = ""))
}, error=function(e){
  name <<- remDr$findElement(using = 'css selector', paste("div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list div.contribution:nth-child(",i,") table:nth-child(1) tbody:nth-child(1) tr:nth-child(1) td.cell > h4.name",sep = ""))
})
name <- name$getElementText()
name <- as.character(name)
title <- remDr$findElement(using = 'css selector', paste("div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list div.contribution:nth-child(",i,") tbody:nth-child(1) tr:nth-child(1) td.cell div.user-text > h5:nth-child(1)"))
title <- title$getElementText()
title <- as.character(title)

iteration <- cbind(name,title,j)

table_data <- rbind(table_data,iteration)
}, error=function(e){
  e
  })
if(inherits(possibleError2, "error")) break
}
  possibleError <- tryCatch({
dalsi <- remDr$findElement(using = 'link text', 'další')
dalsi$clickElement()
}, error=function(e){
  e
  })
if(inherits(possibleError, "error")) break
}
}


dalsi <- remDr$findElement(using = 'css selector', "div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list table.nav-n4.ico:nth-child(51) tbody:nth-child(1) tr:nth-child(1) td.tar a.ico-right > span:nth-child(1)")



tryCatch({
  role <- remDr$findElement(using = 'css selector', 'h3')
  role <- role$getElementText()
  role <- as.character(role)
  }, error=function(e){
                      role <<- "Brak danych (CR)"
  })


  tryCatch({
name <- remDr$findElement(using = 'css selector', paste("div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list div.contribution:nth-child(",i,") table:nth-child(1) tbody:nth-child(1) tr:nth-child(1) td.cell > h4.name",sep = ""))
}, error=function(e){
  name <<- remDr$findElement(using = 'css selector', paste("div.m-bg-1:nth-child(2) div.m-bg-2 div.m-bg-3 div.m-bg-4 div.content:nth-child(2) div.col-a.moot-blog div.disc-list div.contribution:nth-child(",i,") table:nth-child(1) tbody:nth-child(1) tr:nth-child(1) td.cell > h4.name",sep = ""))
})

number <- 10

while (number > 0)  {
  if (number == 3)  {
    print(paste("Coming out from While loop Where number =  ", number))
    break
  }
  print(paste("Values are :  ", number))
  number = number - 1
}



webElem <- remDr$findElement(using = 'css selector', "#ctl00_pageContent_tabPage_ucSearch_pnlSearch_lupPerson1_txtValues_I")
webElem$clickElement()
Sys.sleep(3)
sbox <- remDr$findElement(using = 'css selector', "#ctl00_pageContent_tabPage_ucSearch_pnlSearch_lupPerson1_popup_gridLookup_DXFREditorcol1_I")
sbox$sendKeysToElement(list("Topol, Josef"))
Sys.sleep(5)
webElem2 <- remDr$findElement(using = 'css selector', "table.tabTight table.c.tabTight.tabContent:nth-child(3) tr.cContent:nth-child(1) td.cContent div.content div.dxtcLite.tabPageControl.dxtcSys.dxtc-flex.dxtc-top.dxtc-pc:nth-child(2) div.dxtc-content div.dxpnlControl:nth-child(2) table.search table.insearch div.dxpcLite.dxpclW:nth-child(16) div.dxpc-mainDiv.dxpc-shadow div.dxpc-contentWrapper div.dxpc-content table.dxgvControl.dxgv:nth-child(2) td:nth-child(1) table.dxgvTable:nth-child(1) tbody:nth-child(1) tr.dxgvDataRow.dxgvLVR.dxgvFocusedRow:nth-child(3) > td.dxgv.dx-al:nth-child(2)")
webElem2$clickElement()
webElem3 <- remDr$findElement(using = "xpath", "//div[@id='ctl00_pageContent_tabPage_ucSearch_pnlSearch_btnSearch_CD']//span[@class='dx-vam'][contains(text(),'Search')]")
webElem3$clickElement()
webElem4 <- remDr$findElement(using = 'css selector', "table.tabTight table.c.tabTight.tabContent:nth-child(3) tr.cContent:nth-child(1) td.cContent div.content div.dxtcLite.tabPageControl.dxtcSys.dxtc-flex.dxtc-top.dxtc-pc:nth-child(1) div.dxtc-content div.dxpnlControl:nth-child(2) div.dxpnlControl table.dxgvControl.roundCorner.dxgv:nth-child(6) div.dxgvPagerBottomPanel td.rightmedskip.wmax:nth-child(5) tr:nth-child(2) td.center div:nth-child(2) a.dxp-button.dxp-bi.inlineTable > img.dxWeb_pAll")
webElem4$clickElement()

zzz <- remDr$findElement(using = 'css selector', "#ctl00_pageContent_tabPage_ucSearch_pnlSearch_resultList_pnlList_gvResultList_DXMainTable")
test <- zzz$
test <- as.data.frame(zzz)
zzz <- unlist(strsplit(zzz[[1]], "\n"))
```


